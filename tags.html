<!DOCTYPE html>
<html>
<head>
    <title>All Tags</title>
    <style>
        .tag-list { margin: 20px; }
        .tag { display: inline-block; background: #e0e0e0; color: #333; border-radius: 12px; padding: 4px 12px; font-size: 14px; margin: 4px; text-decoration: none; }
        .article { margin: 16px 0; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>All Tags</h1>
    <div class="tag-list"></div>
    <div id="articles"></div>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script>
    // List of articles with mdFile property for dynamic tag extraction
    const articles = [
        {
            title: "It Costs More Than You Think",
            mdFile: "itcostsmorethanyouthink.md",
            url: "article.html?title=It%20Costs%20More%20Than%20You%20Think"
        },
        {
            title: "The Izu Peninsula (Introduction)",
            mdFile: "The Izu Peninsula (Introduction).md",
            url: "article.html?title=The%20Izu%20Peninsula%20(Introduction)"
        },
        {
            title: "Call Me",
            mdFile: "Call Me.md",
            url: "article.html?title=Call%20Me"
        },
        {
            title: "Calls",
            mdFile: "Calls.md",
            url: "article.html?title=Calls"
        },
        {
            title: "The Izu Peninsula (Introduction) copy",
            mdFile: "The Izu Peninsula (Introduction) copy.md",
            url: "article.html?title=The%20Izu%20Peninsula%20(Introduction)%20copy"
        }
        // Add more articles as needed
    ];

    async function collectTags() {
        const tagSet = new Set();
        for (const article of articles) {
            if (article.mdFile) {
                try {
                    const response = await fetch(article.mdFile);
                    const md = await response.text();
                    const yamlMatch = md.match(/^---\n([\s\S]*?)\n---/);
                    if (yamlMatch) {
                        const yamlData = jsyaml.load(yamlMatch[1]);
                        if (yamlData && yamlData.tags) {
                            yamlData.tags.forEach(tag => tagSet.add(tag));
                        }
                    }
                } catch (e) {
                    // Ignore errors, continue
                }
            }
        }
        return Array.from(tagSet);
    }

    collectTags().then(tags => {
        const tagListDiv = document.querySelector('.tag-list');
        tagListDiv.innerHTML = tags.map(tag =>
            `<a class="tag" href="tags.html?tag=${encodeURIComponent(tag)}">${tag}</a>`
        ).join('');
    });

    // Existing article filtering by tag (keep as is, or update to use dynamic articles if needed)
    const params = new URLSearchParams(window.location.search);
    const tag = params.get('tag');
    const articlesDiv = document.getElementById('articles');
    if (tag) {
        document.title = `Tag: ${tag}`;
        // You may want to update this to filter dynamically loaded articles
        articlesDiv.innerHTML = `<h2>Articles tagged "${tag}"</h2>`;
    } else {
        articlesDiv.innerHTML = "<p>Select a tag to view related articles.</p>";
    }
    </script>
</body>
</html>